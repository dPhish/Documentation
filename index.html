<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Document</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="description" content="Description" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, minimum-scale=1.0"
    />
    <link rel="stylesheet" href="https://unpkg.com/docsify-plugin-toc@1.3.1/dist/light.css">
    <link
      rel="stylesheet"
      href="//cdn.jsdelivr.net/npm/docsify@4/lib/themes/vue.css"
    />
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons|Material+Icons+Outlined|Material+Icons+Two+Tone|Material+Icons+Round|Material+Icons+Sharp"
      rel="stylesheet"
    />

    <!-- <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/docsify-sidebar-collapse/dist/sidebar.min.css" /> -->
    <style>

      .login-container {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 20px;
      }
      
      .login-box {
        background: white;
        border-radius: 12px;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        padding: 40px;
        width: 100%;
        max-width: 500px;
        text-align: center;
      }
      
      .login-logo {
        margin-bottom: 30px;
      }
      
      .login-logo h1 {
        color: #333;
        font-size: 28px;
        margin: 0;
      }
      
      .login-form input {
        width: 100%;
        padding: 12px 15px;
        margin-bottom: 20px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 16px;
        transition: border-color 0.3s;
      }
      
      .login-form input:focus {
        border-color: #667eea;
        outline: none;
      }
      
      .login-button {
        width: 100%;
        padding: 12px;
        background: #667eea;
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 16px;
        cursor: pointer;
        transition: background 0.3s;
      }
      
      .login-button:hover {
        background: #5a6fd5;
      }
      
      .error-message {
        color: #e74c3c;
        margin-top: 15px;
        font-size: 14px;
      }
      
      .success-message {
        color: #27ae60;
        margin-top: 15px;
        font-size: 14px;
      }

      /* App
    ============================================================================= */
      :root {
        /* Color
        ------------------------------------------------------------------------- */
        /* Monochrome */
        --mono-hue: 113;
        --mono-saturation: 0%;

        /* Monochrome shades (darker) and tints (lighter) */
        --mono-shade3: hsl(
          var(--mono-hue),
          var(--mono-saturation),
          20%
        ); /* #333333 */
        --mono-shade2: hsl(
          var(--mono-hue),
          var(--mono-saturation),
          30%
        ); /* #4d4d4d */
        --mono-shade1: hsl(
          var(--mono-hue),
          var(--mono-saturation),
          40%
        ); /* #666666 */
        --mono-base: hsl(
          var(--mono-hue),
          var(--mono-saturation),
          50%
        ); /* #808080 */
        --mono-tint1: hsl(
          var(--mono-hue),
          var(--mono-saturation),
          70%
        ); /* #b3b3b3 */
        --mono-tint2: hsl(
          var(--mono-hue),
          var(--mono-saturation),
          89%
        ); /* #e3e3e3 */
        --mono-tint3: hsl(
          var(--mono-hue),
          var(--mono-saturation),
          97%
        ); /* #f7f7f7 */

        /* Theme */
        --theme-hue: 204;
        --theme-saturation: 90%;
        --theme-lightness: 45%;
        --theme-color: hsl(
          var(--theme-hue),
          var(--theme-saturation),
          var(--theme-lightness)
        );

        /* Typography
        ------------------------------------------------------------------------- */
        /* Modular Scale */
        --modular-scale: 1.333;

        /* Module Scale Calculations (do not edit these) */
        --modular-scale--2: calc(
          var(--modular-scale--1) / var(--modular-scale)
        );
        --modular-scale--1: calc(var(--modular-scale-1) / var(--modular-scale));
        --modular-scale-1: 1rem;
        --modular-scale-2: calc(var(--modular-scale-1) * var(--modular-scale));
        --modular-scale-3: calc(var(--modular-scale-2) * var(--modular-scale));
        --modular-scale-4: calc(var(--modular-scale-3) * var(--modular-scale));
        --modular-scale-5: calc(var(--modular-scale-4) * var(--modular-scale));

        /* Font size */
        --font-size-xxxl: var(--modular-scale-5);
        --font-size-xxl: var(--modular-scale-4);
        --font-size-xl: var(--modular-scale-3);
        --font-size-l: var(--modular-scale-2);
        --font-size-m: var(--modular-scale-1);
        --font-size-s: var(--modular-scale--1);
        --font-size-xs: var(--modular-scale--2);

        /* Utility
        ------------------------------------------------------------------------- */
        /* Borders */
        --border-radius-s: ;
        --border-radius-m: ;
        --border-radius-l: ;

        /* Animations and transitions */
        --duration-slow: 1s;
        --duration-medium: 0.5s;
        --duration-fast: 0.25s;

        /* Misc
        ------------------------------------------------------------------------- */
        /* Spinner */
        --spinner-size: 60px;
        --spinner-track-width: 4px;
        --spinner-track-color: rgba(0, 0, 0, 0.15);
        --spinner-transition-duration: var(--duration-medium);
      }

      .sidebar-nav {
        padding-inline-start: 10px;
      }
      .section.cover.show {
        background: linear-gradient(
          to left bottom,
          hsl(246, 100%, 85%) 0%,
          hsl(74, 100%, 85%) 100%
        ) !important;
      }
      img {
        display: block;
        /* float: none; */
        margin-left: auto;
        margin-right: auto;
        /* width: 50%; */
      }
      h1, h2, h3, h4, h5, h6 {
        pointer-events: none; /* Prevent clicking */
        text-decoration: none !important; /* Remove underline */
      }

      .search{     
           /* border-bottom: 1px solid #0B87DA !important; */
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        padding: 12px 6px !important; 
      }
      .search input{
        border: 1px solid #e1e1e1 !important;
        border-radius: 8px;
      }
      aside.toc-nav{
        opacity: 1 !important;
      }


      #download-btn {
        position: fixed;
        bottom: 15px;
        right: 10px !important;
        z-index: 999 !important;
        background: red;
        color: white;
        padding: 8px 10px;
        border: 0;
        border-radius: 10px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 600;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      }

      #toc-toggle {
        position: fixed;
        top: 15px;
        right: 0 !important;
        z-index: 999 !important;
        background: #f5f5f5;
        padding: 10px 12px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 18px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      }

    .page_toc {
      position: fixed !important;
      top: 0 !important;
      right: 0 !important;
      left: auto !important; 
      width: 280px !important;
      height: 100% !important;
      background: #fff !important;
      border-right: none !important;
      padding: 1rem;
      overflow-y: auto;
      z-index: 999 !important;
      transform: translateX(100%);
      transition: transform 0.3s ease;
    }

    .page_toc.active {
      transform: translateX(0);
    }

    .content {
      transition: margin-right 0.3s ease;
    }

    .page_toc::-webkit-scrollbar {
      width: 6px;
    }
    .page_toc::-webkit-scrollbar-thumb {
      background-color: #bbb;
      border-radius: 3px;
    }
    @media (max-width: 1023px) {
      .page_toc {
        transform: translateX(100%);
      }
      .page_toc.active {
        transform: translateX(0);
      }
    }

    @media (min-width: 1024px) {
      .page_toc {
        transform: none !important;
      }
      #toc-toggle {
        display: none;
      }
    }
    @media (min-width: 1024px) {
      #toc-toggle {
        display: none;
      }
    }

    .markdown-section, .markdown-section * {
      page-break-inside: avoid !important;
      break-inside: avoid !important;
    }

    .markdown-section {
      padding-top: 0 !important;
      margin-top: 0 !important;
    }
      
    </style>
  </head>
  <body class="sticky">
    <!-- <nav>
    <a href="#/">EN</a>
    <a href="#/ar/">Ar</a>
  </nav> -->

   <!-- Login Screen (shown when not authenticated) -->
    <div id="login-screen" class="login-container">
      <div class="login-box">
        <img src="assets/dPhish-crop.png" alt="logo" width="150"/>
        <div class="login-logo">
          <h1>Welcome to dPhish Docs ðŸ‘‹</h1>
          <p>Please log in to access the documentation</p>
        </div>
        <form class="login-form" id="loginForm">
          <input type="text" id="username" placeholder="Username" required />
          <input type="password" id="password" placeholder="Password" required />
          <button type="submit" class="login-button">Login</button>
        </form>
        <div id="login-message" class="error-message"></div>
        
    
      </div>
    </div>

    <div id="docsify-app" style="display: none;">
    
      <div data-app id="main">Please wait...</div>

      <button id="download-btn" onclick="downloadPageAsPDF()"><svg fill="#fafafa" width="18px" height="18px" viewBox="0 0 64 64" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;" stroke="#fafafa"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <rect id="Icons" x="-576" y="-128" width="1280" height="800" style="fill:none;"></rect> <g id="Icons1" serif:id="Icons"> <g id="Strike"> </g> <g id="H1"> </g> <g id="H2"> </g> <g id="H3"> </g> <g id="list-ul"> </g> <g id="hamburger-1"> </g> <g id="hamburger-2"> </g> <g id="list-ol"> </g> <g id="list-task"> </g> <g id="trash"> </g> <g id="vertical-menu"> </g> <g id="horizontal-menu"> </g> <g id="sidebar-2"> </g> <g id="Pen"> </g> <g id="Pen1" serif:id="Pen"> </g> <g id="clock"> </g> <g id="external-link"> </g> <g id="hr"> </g> <g id="info"> </g> <g id="warning"> </g> <g id="plus-circle"> </g> <g id="minus-circle"> </g> <g id="vue"> </g> <path id="download" d="M48.089,52.095l0,4l-32.049,0l0,-4l32.049,0Zm-16.025,-4l-16.024,-16l8.098,0l-0.049,-24l15.975,0l0.048,24l7.977,0l-16.025,16Z"></path> <g id="cog"> </g> <g id="logo"> </g> <g id="radio-check"> </g> <g id="eye-slash"> </g> <g id="eye"> </g> <g id="toggle-off"> </g> <g id="shredder"> </g> <g id="spinner--loading--dots-" serif:id="spinner [loading, dots]"> </g> <g id="react"> </g> <g id="check-selected"> </g> <g id="turn-off"> </g> <g id="code-block"> </g> <g id="user"> </g> <g id="coffee-bean"> </g> <g id="coffee-beans"> <g id="coffee-bean1" serif:id="coffee-bean"> </g> </g> <g id="coffee-bean-filled"> </g> <g id="coffee-beans-filled"> <g id="coffee-bean2" serif:id="coffee-bean"> </g> </g> <g id="clipboard"> </g> <g id="clipboard-paste"> </g> <g id="clipboard-copy"> </g> <g id="Layer1"> </g> </g> </g></svg></button>

      <div id="toc-toggle" onclick="toggleTOC()">â˜°</div>

        </div>
    <script>

      function checkAuth() {
        const authenticated = localStorage.getItem('authenticated') === 'true';
        if (authenticated) {
          document.getElementById('login-screen').style.display = 'none';
          document.getElementById('docsify-app').style.display = 'block';
  
        } else {
          document.getElementById('login-screen').style.display = 'flex';
          document.getElementById('docsify-app').style.display = 'none';
        }
      }

      function toggleTOC() {
        const toc = document.querySelector('.page_toc');
            const content = document.querySelector('.content');
            if (toc) toc.classList.toggle('active');
            if (content) content.classList.toggle('shifted');
      }

      function downloadPageAsPDF() {
        // Hide elements that shouldn't be in PDF
        const elementsToHide = [
          '#download-btn',
          '#toc-toggle',
          '.page_toc',
          '.sidebar-toggle',
          '.sidebar',
          '.app-nav',
          '.progress'
        ];
        
        // Show loading indicator
        const loading = document.createElement('div');
        loading.style.position = 'fixed';
        loading.style.top = '0';
        loading.style.left = '0';
        loading.style.width = '100%';
        loading.style.height = '100%';
        loading.style.backgroundColor = 'rgba(0,0,0,0.5)';
        loading.style.display = 'flex';
        loading.style.justifyContent = 'center';
        loading.style.alignItems = 'center';
        loading.style.zIndex = '9999';
        loading.innerHTML = '<div style="color: white; font-size: 24px;">Generating PDF...</div>';
        document.body.appendChild(loading);

        // Hide elements
        elementsToHide.forEach(selector => {
          const el = document.querySelector(selector);
          if (el) el.style.visibility = 'hidden';
        });

        // Get the element to print
        const element = document.querySelector('.markdown-section');
        if (!element) return;

        // PDF options
        const opt = {
          margin: [0.5, 0.5, 0.5, 0.5],
          filename: 'documentation.pdf',
          image: { type: 'jpeg', quality: 0.98 },
          html2canvas: { 
            scale: 2,
            scrollY: 0,
            useCORS: true,
            allowTaint: true,
            letterRendering: true
          },
          jsPDF: { 
            unit: 'in', 
            format: 'a4', 
            orientation: 'portrait',
            compress: true
          },
          pagebreak: { 
            mode: ['avoid-all', 'css', 'legacy'],
            before: '.page-break'
          }
        };

        // Generate PDF
        html2pdf()
          .set(opt)
          .from(element)
          .toPdf()
          .get('pdf')
          .then(function(pdf) {
            const totalPages = pdf.internal.getNumberOfPages();
            for (let i = 1; i <= totalPages; i++) {
              pdf.setPage(i);
              pdf.setFontSize(10);
              pdf.setTextColor(150);
              pdf.text(
                'Page ' + i + ' of ' + totalPages,
                pdf.internal.pageSize.getWidth() - 2,
                pdf.internal.pageSize.getHeight() - 0.5
              );
            }
          })
          .save()
          .then(() => {
            elementsToHide.forEach(selector => {
              const el = document.querySelector(selector);
              if (el) el.style.visibility = 'visible';
            });
            document.body.removeChild(loading);
          })
          .catch(err => {
            elementsToHide.forEach(selector => {
              const el = document.querySelector(selector);
              if (el) el.style.visibility = 'visible';
            });
            document.body.removeChild(loading);
            alert('Failed to generate PDF. Please try again.');
          });
      }

      
      window.$docsify = {
        toc: {
          tocMaxLevel: 3,
          target: 'h2, h3, h4',
          ignoreHeaders:  ['<!-- {docsify-ignore} -->', '<!-- {docsify-ignore-all} -->'],
          position: 'right'
        },
        coverpage: false,
        onlyCover: false,
        routerMode: "history",
        name: "dPhish",
        // repo: 'https://github.com/dPhish/Documentation',
        el: "#main",
        mergeNavbar: true,
        loadNavbar: true,
        loadSidebar: true,
        alias: {
          "/.*/_sidebar.md": "/_sidebar.md",
        },
        auto2top: true,
        keyBindings: {
          focusSearch: true,
          toggleSidebar: true,
        },
        maxLevel: 3,
        externalLinkTarget: "_blank",
        search: "auto", // default

        // complete configuration parameters
        search: {
          maxAge: 86400000, // Expiration time, the default one day
          paths: "auto",
          placeholder: "Type to search",
          noData: "No Results!",
          // Headline depth, 1 - 6
          depth: 6,
          hideOtherSidebarContent: false, // whether or not to hide other sidebar content
        },

        'flexible-alerts': {
          // style: "flat",

          note: {
            label: "Note",
          },

          tip: {
            label: "Tip",
          },

          warning: {
            label: "warning",
          },

          attention: {
            label: "Attention",
          },
        },
      };
   

      document.getElementById('loginForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        const messageEl = document.getElementById('login-message');
        
        messageEl.textContent = 'Authenticating...';
        messageEl.className = 'success-message';
        
        try {

           const response = await fetch('https://testing.dphish.live/api/api-auth/login/', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password }),
          });

          const data = await response.json();

          console.log('response', response)
          if (response.ok) {
            // If authentication is successful, store the token
            localStorage.setItem('authenticated', 'true');
            localStorage.setItem('authToken', data.access); // Store the token if received
            messageEl.textContent = 'Login successful! Redirecting...';
             setTimeout(() => {
              checkAuth();
            }, 1000);
            window.location.href = '/welcome'; // Redirect to the main Docsify page
          } else {
      
            document.getElementById('login-message').innerText = 'Invalid username or password';
            messageEl.textContent = data.message;
            messageEl.className = 'error-message';
          }
        } catch (error) {
          document.getElementById('errorMessage').innerText = 'Error connecting to the server';
          messageEl.textContent = 'Error connecting to the server';
          messageEl.className = 'error-message';
        }

      });
      
      // Check authentication status on page load
      document.addEventListener('DOMContentLoaded', checkAuth);

   </script>

    <script src="//cdn.jsdelivr.net/npm/docsify@4"></script>
    <script src="//cdn.jsdelivr.net/npm/docsify/lib/plugins/emoji.min.js"></script>
    <script src="//unpkg.com/docsify/lib/plugins/search.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/docsify-sidebar-collapse/dist/docsify-sidebar-collapse.min.js"></script>
    <script src="https://unpkg.com/docsify-plugin-flexible-alerts"></script>
    <script src="//unpkg.com/docsify-plugin-toc"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://unpkg.com/docsify-plugin-toc@1.3.1/dist/docsify-plugin-toc.min.js"></script>
  </body>
</html>
